<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>🕌 Salah Times</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#181818">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="🕌 Salah Times">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport-fit" content="cover">
    <meta name="application-name" content="Salah Times">
    <meta name="msapplication-TileColor" content="#181818">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-192.png">
    <link rel="mask-icon" href="icon-192.png" color="#181818">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #181818;
            min-height: 100vh;
            color: #E6E6E6;
            margin: 0;
            padding: 0;
            /* Support for notch devices */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            background: #181818;
            overflow: hidden;
            padding-top: 15px; /* Space for status bar */
        }

        .status-info {
            padding: 15px 20px 20px 20px;
            text-align: center;
        }

        .mosque-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #F5F5F5;
        }

        .current-date {
            font-size: 16px;
            font-weight: 600;
            color: #B8B8B8;
        }

        /* PWA Status Indicator */
        .pwa-status {
            margin-top: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .pwa-status.online {
            background: rgba(16, 163, 127, 0.2);
            color: #10A37F;
        }

        .pwa-status.offline {
            background: rgba(255, 149, 0, 0.2);
            color: #FF9500;
        }

        .next-prayer {
            background: #1F1F1F;
            margin: 12px 12px;
            padding: 16px;
            border-radius: 14px;
            border: 1px solid #2E2E2E;
            text-align: center;
        }

        .next-prayer h3 {
            font-size: 15px;
            color: #B8B8B8;
            margin-bottom: 8px;
        }

        .countdown {
            font-size: 28px;
            font-weight: 700;
            color: #10A37F;
            margin: 12px 0;
        }

        .prayer-name {
            font-size: 18px;
            font-weight: 600;
            color: #F5F5F5;
        }

        .today-prayers {
            margin: 20px 12px 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #F5F5F5;
            margin-bottom: 12px;
            padding-left: 5px;
            text-align: center;
        }

        .prayer-times {
            background: #1F1F1F;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #2E2E2E;
        }

        .prayer-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 18px;
            border-bottom: 1px solid #2E2E2E;
            transition: all 0.3s ease;
        }

        .prayer-row:last-child {
            border-bottom: none;
        }

        .prayer-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .prayer-row.current {
            background: linear-gradient(135deg, #10A37F, #0D8B6F);
            color: white;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prayer-info {
            display: flex;
            align-items: center;
        }

        .prayer-icon {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prayer-row.current .prayer-icon {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .prayer-details h4 {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 2px;
            color: inherit;
        }

        .prayer-details p {
            font-size: 12px;
            opacity: 0.7;
        }

        .prayer-time {
            font-size: 17px;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .jamah-time {
            font-size: 17px;
            font-weight: 700;
        }

        .begin-time {
            font-size: 12px;
            opacity: 0.6;
            font-weight: 400;
            margin-top: 2px;
        }

        .tabs {
            display: flex;
            background: #1F1F1F;
            margin: 15px 12px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #2E2E2E;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            font-size: 13px;
            font-weight: 600;
            color: #B8B8B8;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #2E2E2E;
            color: #F5F5F5;
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: #E6E6E6;
        }

        .chart-container {
            background: #1F1F1F;
            margin: 0 8px 25px;
            padding: 28px 16px;
            border-radius: 16px;
            border: 1px solid #2E2E2E;
            display: none;
        }

        .chart-container.active {
            display: block;
        }

        .chart-container h3 {
            color: #F5F5F5;
            margin-bottom: 18px;
            text-align: center;
            font-size: 16px;
            font-weight: 700;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin-top: 12px;
        }

        .day-item {
            text-align: center;
            padding: 8px 2px;
            background: #2A2A2A;
            border-radius: 8px;
            font-size: 7px;
            border: 1px solid #3A3A3A;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .day-item:hover {
            background: #353535;
        }

        .day-item.today {
            background: linear-gradient(135deg, #10A37F, #0D8B6F);
            color: white;
            border: 1px solid #10A37F;
        }

        .day-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #F5F5F5;
            font-size: 10px;
        }

        .prayer-times-mini {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-top: 4px;
        }

        .prayer-time-mini {
            font-size: 8px;
            color: #B8B8B8;
            line-height: 1.3;
        }

        .day-item.today .prayer-time-mini {
            color: rgba(255, 255, 255, 0.9);
        }

        .monthly-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 12px;
        }

        .month-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #2A2A2A;
            border-radius: 5px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid #3A3A3A;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .month-day:hover {
            background: #353535;
        }

        .month-day.today {
            background: linear-gradient(135deg, #10A37F, #0D8B6F);
            color: white;
            border: 1px solid #10A37F;
        }

        .month-day.has-data:hover {
            background: #404040;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #1F1F1F;
            margin: 50% auto;
            padding: 20px;
            border: 1px solid #2E2E2E;
            border-radius: 16px;
            width: 85%;
            max-width: 350px;
            position: relative;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #2E2E2E;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #F5F5F5;
        }

        .close {
            color: #B8B8B8;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            padding: 8px;
            line-height: 1;
        }

        .close:hover {
            color: #F5F5F5;
        }

        .modal-prayer-list {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .modal-prayer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #2A2A2A;
            border-radius: 12px;
            border: 1px solid #3A3A3A;
        }

        .modal-prayer-info {
            display: flex;
            align-items: center;
        }

        .modal-prayer-icon {
            font-size: 20px;
            margin-right: 14px;
        }

        .modal-prayer-name {
            font-size: 16px;
            font-weight: 600;
            color: #F5F5F5;
        }

        .modal-prayer-time {
            font-size: 16px;
            font-weight: 700;
            color: #10A37F;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .modal-jamah-time {
            font-size: 16px;
            font-weight: 700;
        }

        .modal-begin-time {
            font-size: 11px;
            opacity: 0.6;
            font-weight: 400;
            margin-top: 3px;
            color: #B8B8B8;
        }

        .footer {
            text-align: center;
            padding: 12px;
            color: #B8B8B8;
            font-size: 11px;
            border-top: 1px solid #2E2E2E;
            margin-bottom: env(safe-area-inset-bottom);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .day-header {
            font-weight: 600;
            text-align: center;
            padding: 10px;
            color: #B8B8B8;
            font-size: 12px;
        }

        .month-navigation {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
        }

        .nav-arrow {
            background: #2A2A2A;
            border: 1px solid #3A3A3A;
            color: #E6E6E6;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            user-select: none;
        }

        .nav-arrow:hover {
            background: #353535;
            color: #F5F5F5;
        }

        .nav-arrow:disabled {
            background: #1A1A1A;
            color: #666;
            cursor: not-allowed;
            border-color: #2A2A2A;
        }

        .nav-arrow:disabled:hover {
            background: #1A1A1A;
            color: #666;
        }

        .month-title {
            font-size: 16px;
            font-weight: 700;
            color: #F5F5F5;
            text-align: center;
            flex: 1;
            margin: 0 12px;
        }

        /* Install prompt styles */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #10A37F;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 2000;
            max-width: 90%;
            text-align: center;
            animation: slideUp 0.3s ease;
        }

        .install-prompt.show {
            display: block;
        }

        .install-prompt-text {
            margin-bottom: 12px;
            font-weight: 600;
        }

        .install-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .install-btn {
            background: white;
            color: #10A37F;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        .install-btn.dismiss {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* Update notification */
        .update-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #FF9500;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: none;
            z-index: 2000;
            font-size: 14px;
            font-weight: 600;
            animation: slideDown 0.3s ease;
        }

        .update-notification.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* PWA specific styles */
        @media (display-mode: fullscreen) {
            body {
                padding-top: env(safe-area-inset-top);
            }
            
            .container {
                padding-top: 40px;
            }
        }

        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
            }
            
            .container {
                padding-top: 40px;
            }
            
            .pwa-status {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-info">
            <h1 class="mosque-name">Shahjalal Salah Times</h1>
            <div class="current-date" id="currentDate">Sunday, July 6, 2025</div>
            <div class="pwa-status offline" id="pwaStatus">📱 Loading...</div>
        </div>

        <div class="next-prayer">
            <h3>Next Prayer</h3>
            <div class="prayer-name" id="nextPrayerName">Fajr</div>
            <div class="countdown pulse" id="countdown">16:32:45</div>
        </div>

        <div class="today-prayers">
            <h2 class="section-title">Today's Prayer Times</h2>
            <div class="prayer-times" id="todayPrayers">
                <div class="prayer-row" data-prayer="fajr">
                    <div class="prayer-info">
                        <div class="prayer-icon">🌅</div>
                        <div class="prayer-details">
                            <h4>Fajr</h4>
                            <p></p>
                        </div>
                    </div>
                    <div class="prayer-time">
                        <div class="jamah-time">4:15</div>
                        <div class="begin-time">2:57</div>
                    </div>
                </div>
                <div class="prayer-row" data-prayer="zuhr">
                    <div class="prayer-info">
                        <div class="prayer-icon">☀️</div>
                        <div class="prayer-details">
                            <h4>Zuhr</h4>
                            <p></p>
                        </div>
                    </div>
                    <div class="prayer-time">
                        <div class="jamah-time">1:30</div>
                        <div class="begin-time">1:10</div>
                    </div>
                </div>
                <div class="prayer-row" data-prayer="asr">
                    <div class="prayer-info">
                        <div class="prayer-icon">🌤️</div>
                        <div class="prayer-details">
                            <h4>Asr</h4>
                            <p></p>
                        </div>
                    </div>
                    <div class="prayer-time">
                        <div class="jamah-time">7:30</div>
                        <div class="begin-time">6:40</div>
                    </div>
                </div>
                <div class="prayer-row" data-prayer="maghrib">
                    <div class="prayer-info">
                        <div class="prayer-icon">🌆</div>
                        <div class="prayer-details">
                            <h4>Maghrib</h4>
                            <p></p>
                        </div>
                    </div>
                    <div class="prayer-time">
                        <div class="jamah-time">9:26</div>
                        <div class="begin-time">9:21</div>
                    </div>
                </div>
                <div class="prayer-row" data-prayer="isha">
                    <div class="prayer-info">
                        <div class="prayer-icon">🌙</div>
                        <div class="prayer-details">
                            <h4>Isha</h4>
                            <p></p>
                        </div>
                    </div>
                    <div class="prayer-time">
                        <div class="jamah-time">10:50</div>
                        <div class="begin-time">10:37</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showChart('weekly')">Weekly</button>
            <button class="tab" onclick="showChart('monthly')">Monthly</button>
        </div>

        <div class="chart-container active" id="weeklyChart">
            <h3>This Week | 6 - 12 July</h3>
            <div class="week-grid" id="weekGrid">
                <!-- Weekly prayer times will be dynamically generated here -->
            </div>
        </div>

        <div class="chart-container" id="monthlyChart">
            <div class="month-navigation">
                <button class="nav-arrow" id="prevMonth" onclick="changeMonth(-1)">‹</button>
                <h3 class="month-title" id="monthTitle">This Month | July 2025</h3>
                <button class="nav-arrow" id="nextMonth" onclick="changeMonth(1)">›</button>
            </div>
            <div class="monthly-grid" id="monthGrid">
                <!-- Monthly calendar will be dynamically generated here -->
            </div>
        </div>

        <div class="footer">
            Manor Park Islamic Cultural Centre<br>
            722-726 Romford Road, London E12 6BT
        </div>
    </div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <div class="install-prompt-text">
            📱 Install Salah Times as an app for quick access!
        </div>
        <div class="install-buttons">
            <button class="install-btn" onclick="installApp()">Install</button>
            <button class="install-btn dismiss" onclick="dismissInstall()">Maybe Later</button>
        </div>
    </div>

    <!-- Update Notification -->
    <div id="updateNotification" class="update-notification">
        📱 New version available! Tap to update.
    </div>

    <!-- Modal for Day Details -->
    <div id="dayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Prayer Times</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-prayer-list" id="modalPrayerList">
                <!-- Prayer times will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // PWA Variables
        let deferredPrompt;
        let installPromptShown = false;
        let isOnline = navigator.onLine;

        // Existing prayer data and variables
        const sunriseData = {
            7: {
                1: "4:47", 2: "4:48", 3: "4:49", 4: "4:49", 5: "4:50", 6: "4:51", 7: "4:52",
                8: "4:53", 9: "4:54", 10: "4:55", 11: "4:56", 12: "4:57", 13: "4:58", 14: "4:59",
                15: "5:00", 16: "5:02", 17: "5:03", 18: "5:04", 19: "5:05", 20: "5:07", 21: "5:08",
                22: "5:09", 23: "5:11", 24: "5:12", 25: "5:13", 26: "5:15", 27: "5:16", 28: "5:18",
                29: "5:19", 30: "5:21", 31: "5:22"
            },
            8: {
                1: "5:24", 2: "5:25", 3: "5:27", 4: "5:28", 5: "5:30", 6: "5:31", 7: "5:33",
                8: "5:34", 9: "5:36", 10: "5:38", 11: "5:39", 12: "5:41", 13: "5:42", 14: "5:44",
                15: "5:45", 16: "5:47", 17: "5:49", 18: "5:50", 19: "5:52", 20: "5:53", 21: "5:55",
                22: "5:57", 23: "5:58", 24: "6:00", 25: "6:01", 26: "6:03", 27: "6:05", 28: "6:06",
                29: "6:08", 30: "6:09", 31: "6:11"
            },
            9: {
                1: "6:13", 2: "6:14", 3: "6:16", 4: "6:17", 5: "6:19", 6: "6:20", 7: "6:22",
                8: "6:24", 9: "6:25", 10: "6:27", 11: "6:28", 12: "6:30", 13: "6:32", 14: "6:33",
                15: "6:35", 16: "6:36", 17: "6:38", 18: "6:40", 19: "6:41", 20: "6:43", 21: "6:44",
                22: "6:46", 23: "6:48", 24: "6:49", 25: "6:51", 26: "6:52", 27: "6:54", 28: "6:56",
                29: "6:57", 30: "6:59"
            },
            10: {
                1: "7:01", 2: "7:02", 3: "7:04", 4: "7:05", 5: "7:07", 6: "7:09", 7: "7:10",
                8: "7:12", 9: "7:14", 10: "7:15", 11: "7:17", 12: "7:19", 13: "7:20", 14: "7:22",
                15: "7:24", 16: "7:25", 17: "7:27", 18: "7:29", 19: "7:31", 20: "7:32", 21: "7:34",
                22: "7:36", 23: "7:38", 24: "7:39", 25: "7:41", 26: "6:43", 27: "6:45", 28: "6:46",
                29: "6:48", 30: "6:50", 31: "6:52"
            },
            11: {
                1: "6:53", 2: "6:55", 3: "6:57", 4: "6:59", 5: "7:00", 6: "7:02", 7: "7:04",
                8: "7:06", 9: "7:07", 10: "7:09", 11: "7:11", 12: "7:13", 13: "7:14", 14: "7:16",
                15: "7:18", 16: "7:20", 17: "7:21", 18: "7:23", 19: "7:25", 20: "7:26", 21: "7:28",
                22: "7:29", 23: "7:31", 24: "7:33", 25: "7:34", 26: "7:36", 27: "7:37", 28: "7:39",
                29: "7:40", 30: "7:42"
            },
            12: {
                1: "7:43", 2: "7:45", 3: "7:46", 4: "7:47", 5: "7:48", 6: "7:50", 7: "7:51",
                8: "7:52", 9: "7:53", 10: "7:54", 11: "7:55", 12: "7:56", 13: "7:57", 14: "7:58",
                15: "7:59", 16: "8:00", 17: "8:01", 18: "8:01", 19: "8:02", 20: "8:03", 21: "8:03",
                22: "8:04", 23: "8:04", 24: "8:05", 25: "8:05", 26: "8:05", 27: "8:05", 28: "8:06",
                29: "8:06", 30: "8:06", 31: "8:06"
            },
            6: {
                29: "6:13", 30: "6:14"
            }
        };

        // Prayer times data for July 2025 with corrected Maghrib Jamah times
        const prayerData = {
            7: {
                1: { fajr: { jamah: "4:00", begin: "2:51" }, zuhr: { jamah: "1:30", begin: "1:10" }, asr: { jamah: "7:30", begin: "6:41" }, maghrib: { jamah: "9:29", begin: "9:24" }, isha: { jamah: "11:00", begin: "10:41" } },
                2: { fajr: { jamah: "4:00", begin: "2:52" }, zuhr: { jamah: "1:30", begin: "1:10" }, asr: { jamah: "7:30", begin: "6:41" }, maghrib: { jamah: "9:28", begin: "9:23" }, isha: { jamah: "11:00", begin: "10:41" } },
                3: { fajr: { jamah: "4:00", begin: "2:53" }, zuhr: { jamah: "1:30", begin: "1:10" }, asr: { jamah: "7:30", begin: "6:41" }, maghrib: { jamah: "9:28", begin: "9:23" }, isha: { jamah: "11:00", begin: "10:40" } },
                4: { fajr: { jamah: "4:00", begin: "2:54" }, zuhr: { jamah: "1:30", begin: "1:10" }, asr: { jamah: "7:30", begin: "6:40" }, maghrib: { jamah: "9:27", begin: "9:22" }, isha: { jamah: "11:00", begin: "10:39" } },
                5: { fajr: { jamah: "4:00", begin: "2:55" }, zuhr: { jamah: "1:30", begin: "1:10" }, asr: { jamah: "7:30", begin: "6:40" }, maghrib: { jamah: "9:27", begin: "9:22" }, isha: { jamah: "11:00", begin: "10:38" } },
                6: { fajr: { jamah: "4:15", begin: "2:57" }, zuhr: { jamah: "1:30", begin: "1:10" }, asr: { jamah: "7:30", begin: "6:40" }, maghrib: { jamah: "9:26", begin: "9:21" }, isha: { jamah: "10:50", begin: "10:37" } },
                7: { fajr: { jamah: "4:15", begin: "2:58" }, zuhr: { jamah: "1:30", begin: "1:11" }, asr: { jamah: "7:30", begin: "6:40" }, maghrib: { jamah: "9:26", begin: "9:21" }, isha: { jamah: "10:50", begin: "10:36" } },
                8: { fajr: { jamah: "4:15", begin: "2:59" }, zuhr: { jamah: "1:30", begin: "1:11" }, asr: { jamah: "7:30", begin: "6:40" }, maghrib: { jamah: "9:25", begin: "9:20" }, isha: { jamah: "10:50", begin: "10:35" } },
                9: { fajr: { jamah: "4:15", begin: "3:00" }, zuhr: { jamah: "1:30", begin: "1:11" }, asr: { jamah: "7:30", begin: "6:39" }, maghrib: { jamah: "9:24", begin: "9:19" }, isha: { jamah: "10:50", begin: "10:34" } },
                10: { fajr: { jamah: "4:15", begin: "3:02" }, zuhr: { jamah: "1:30", begin: "1:11" }, asr: { jamah: "7:30", begin: "6:39" }, maghrib: { jamah: "9:23", begin: "9:18" }, isha: { jamah: "10:50", begin: "10:33" } },
                11: { fajr: { jamah: "4:15", begin: "3:03" }, zuhr: { jamah: "1:30", begin: "1:11" }, asr: { jamah: "7:30", begin: "6:39" }, maghrib: { jamah: "9:23", begin: "9:18" }, isha: { jamah: "10:50", begin: "10:32" } },
                12: { fajr: { jamah: "4:15", begin: "3:04" }, zuhr: { jamah: "1:30", begin: "1:11" }, asr: { jamah: "7:30", begin: "6:38" }, maghrib: { jamah: "9:22", begin: "9:17" }, isha: { jamah: "10:50", begin: "10:31" } },
                13: { fajr: { jamah: "4:15", begin: "3:06" }, zuhr: { jamah: "1:30", begin: "1:11" }, asr: { jamah: "7:30", begin: "6:38" }, maghrib: { jamah: "9:21", begin: "9:16" }, isha: { jamah: "10:45", begin: "10:30" } },
                14: { fajr: { jamah: "4:15", begin: "3:07" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:37" }, maghrib: { jamah: "9:20", begin: "9:15" }, isha: { jamah: "10:45", begin: "10:28" } },
                15: { fajr: { jamah: "4:15", begin: "3:09" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:37" }, maghrib: { jamah: "9:19", begin: "9:14" }, isha: { jamah: "10:45", begin: "10:27" } },
                16: { fajr: { jamah: "4:15", begin: "3:10" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:36" }, maghrib: { jamah: "9:18", begin: "9:13" }, isha: { jamah: "10:45", begin: "10:26" } },
                17: { fajr: { jamah: "4:15", begin: "3:12" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:36" }, maghrib: { jamah: "9:17", begin: "9:12" }, isha: { jamah: "10:45", begin: "10:24" } },
                18: { fajr: { jamah: "4:15", begin: "3:13" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:35" }, maghrib: { jamah: "9:16", begin: "9:11" }, isha: { jamah: "10:45", begin: "10:23" } },
                19: { fajr: { jamah: "4:15", begin: "3:15" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:35" }, maghrib: { jamah: "9:14", begin: "9:09" }, isha: { jamah: "10:45", begin: "10:21" } },
                20: { fajr: { jamah: "4:30", begin: "3:16" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:34" }, maghrib: { jamah: "9:13", begin: "9:08" }, isha: { jamah: "10:35", begin: "10:20" } },
                21: { fajr: { jamah: "4:30", begin: "3:18" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:33" }, maghrib: { jamah: "9:12", begin: "9:07" }, isha: { jamah: "10:35", begin: "10:18" } },
                22: { fajr: { jamah: "4:30", begin: "3:20" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:33" }, maghrib: { jamah: "9:11", begin: "9:06" }, isha: { jamah: "10:35", begin: "10:17" } },
                23: { fajr: { jamah: "4:30", begin: "3:21" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:32" }, maghrib: { jamah: "9:09", begin: "9:04" }, isha: { jamah: "10:35", begin: "10:15" } },
                24: { fajr: { jamah: "4:30", begin: "3:23" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:31" }, maghrib: { jamah: "9:08", begin: "9:03" }, isha: { jamah: "10:35", begin: "10:13" } },
                25: { fajr: { jamah: "4:30", begin: "3:25" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:30" }, maghrib: { jamah: "9:07", begin: "9:02" }, isha: { jamah: "10:35", begin: "10:12" } },
                26: { fajr: { jamah: "4:30", begin: "3:26" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:29" }, maghrib: { jamah: "9:05", begin: "9:00" }, isha: { jamah: "10:25", begin: "10:10" } },
                27: { fajr: { jamah: "4:30", begin: "3:28" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:29" }, maghrib: { jamah: "9:04", begin: "8:59" }, isha: { jamah: "10:25", begin: "10:08" } },
                28: { fajr: { jamah: "4:30", begin: "3:30" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:28" }, maghrib: { jamah: "9:02", begin: "8:57" }, isha: { jamah: "10:25", begin: "10:06" } },
                29: { fajr: { jamah: "4:30", begin: "3:32" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:27" }, maghrib: { jamah: "9:01", begin: "8:56" }, isha: { jamah: "10:25", begin: "10:04" } },
                30: { fajr: { jamah: "4:30", begin: "3:33" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:26" }, maghrib: { jamah: "8:59", begin: "8:54" }, isha: { jamah: "10:25", begin: "10:03" } },
                31: { fajr: { jamah: "4:30", begin: "3:35" }, zuhr: { jamah: "1:30", begin: "1:12" }, asr: { jamah: "7:30", begin: "6:25" }, maghrib: { jamah: "8:57", begin: "8:52" }, isha: { jamah: "10:25", begin: "10:01" } }
            }
            // Add other months if needed...
        };

        const prayerNames = ['Fajr', 'Zuhr', 'Asr', 'Maghrib', 'Isha'];
        const prayerIcons = ['🌅', '☀️', '🌤️', '🌆', '🌙'];
        
        let currentDisplayMonth = 7; // July 2025
        let currentDisplayYear = 2025;

        // PWA Functions
        function updatePWAStatus() {
            const statusEl = document.getElementById('pwaStatus');
            if (navigator.onLine) {
                statusEl.className = 'pwa-status online';
                statusEl.textContent = '🌐 Online';
            } else {
                statusEl.className = 'pwa-status offline';
                statusEl.textContent = '📱 Offline';
            }
        }

        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            setTimeout(() => {
                if (!installPromptShown && !localStorage.getItem('installPromptDismissed')) {
                    showInstallPrompt();
                }
            }, 3000);
        });

        window.addEventListener('appinstalled', () => {
            hideInstallPrompt();
            localStorage.setItem('installPromptDismissed', 'true');
            console.log('PWA was installed');
        });

        function showInstallPrompt() {
            // Don't show if already in standalone mode
            if (window.matchMedia('(display-mode: standalone)').matches) {
                return;
            }
            
            installPromptShown = true;
            document.getElementById('installPrompt').classList.add('show');
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            } else {
                // Show manual install instructions
                if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
                    alert('To install on iOS:\n1. Tap the Share button (↗️)\n2. Select "Add to Home Screen"\n3. Tap "Add"');
                } else if (navigator.userAgent.includes('Android')) {
                    alert('To install on Android:\n1. Tap the menu (⋮) in your browser\n2. Select "Add to Home screen"\n3. Tap "Add"');
                } else {
                    alert('To install:\nLook for the "Install" button in your browser\'s address bar or menu');
                }
            }
            
            hideInstallPrompt();
        }

        function dismissInstall() {
            hideInstallPrompt();
            localStorage.setItem('installPromptDismissed', 'true');
        }

        function hideInstallPrompt() {
            document.getElementById('installPrompt').classList.remove('show');
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Check every minute
                        
                        // Handle updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification();
                                }
                            });
                        });
                    }, function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        function showUpdateNotification() {
            const notification = document.getElementById('updateNotification');
            notification.classList.add('show');
            
            notification.addEventListener('click', () => {
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                }
            });
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 10000);
        }

        // Handle online/offline status
        window.addEventListener('online', () => {
            updatePWAStatus();
            console.log('App is online');
        });

        window.addEventListener('offline', () => {
            updatePWAStatus();
            console.log('App is offline');
        });

        // Handle URL shortcuts
        function handleUrlShortcuts() {
            const hash = window.location.hash;
            if (hash === '#today') {
                // Scroll to today's prayers
                setTimeout(() => {
                    document.querySelector('.today-prayers').scrollIntoView({ behavior: 'smooth' });
                }, 500);
            } else if (hash === '#weekly') {
                // Show weekly view
                setTimeout(() => {
                    showChart('weekly');
                }, 500);
            } else if (hash === '#monthly') {
                // Show monthly view
                setTimeout(() => {
                    showChart('monthly');
                }, 500);
            }
            // Clear the hash
            if (hash) {
                window.history.replaceState(null, null, window.location.pathname);
            }
        }

        // [Rest of your existing JavaScript functions remain the same...]
        function showChart(type) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.chart-container').forEach(chart => chart.classList.remove('active'));
            
            if (type === 'weekly') {
                document.getElementById('weeklyChart').classList.add('active');
            } else {
                document.getElementById('monthlyChart').classList.add('active');
            }
        }

        function changeMonth(direction) {
            currentDisplayMonth += direction;
            
            if (currentDisplayMonth > 12) {
                currentDisplayMonth = 1;
                currentDisplayYear++;
            } else if (currentDisplayMonth < 1) {
                currentDisplayMonth = 12;
                currentDisplayYear--;
            }
            
            generateMonthlyView();
            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();
            
            const prevButton = document.getElementById('prevMonth');
            const nextButton = document.getElementById('nextMonth');
            
            // Disable previous button if we're at current month
            if (currentDisplayYear === currentYear && currentDisplayMonth === currentMonth) {
                prevButton.disabled = true;
            } else {
                prevButton.disabled = false;
            }
            
            // Disable next button if we're at December 2025
            if (currentDisplayYear === 2025 && currentDisplayMonth === 12) {
                nextButton.disabled = true;
            } else {
                nextButton.disabled = false;
            }
        }

        function generateMonthlyView() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            const monthTitle = document.getElementById('monthTitle');
            monthTitle.textContent = `${monthNames[currentDisplayMonth - 1]} ${currentDisplayYear}`;
            
            const monthGrid = document.getElementById('monthGrid');
            
            // Clear existing grid except headers
            const headers = monthGrid.querySelectorAll('.day-header');
            monthGrid.innerHTML = '';
            
            // Re-add headers
            const dayHeaders = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            dayHeaders.forEach(header => {
                const headerEl = document.createElement('div');
                headerEl.className = 'day-header';
                headerEl.textContent = header;
                monthGrid.appendChild(headerEl);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentDisplayYear, currentDisplayMonth - 1, 1);
            const lastDay = new Date(currentDisplayYear, currentDisplayMonth, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'month-day';
                monthGrid.appendChild(emptyDay);
            }
            
            // Add days of the month
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === currentDisplayYear && 
                                  today.getMonth() + 1 === currentDisplayMonth;
            const todayDate = today.getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'month-day';
                dayEl.textContent = day;
                dayEl.setAttribute('onclick', `openDayModal(${day}, ${currentDisplayMonth})`);
                
                // Check if this day has data
                if (prayerData[currentDisplayMonth] && prayerData[currentDisplayMonth][day]) {
                    dayEl.classList.add('has-data');
                }
                
                // Mark today
                if (isCurrentMonth && day === todayDate) {
                    dayEl.classList.add('today');
                }
                
                monthGrid.appendChild(dayEl);
            }
        }

        function openDayModal(day, month) {
            const dayTimes = prayerData[month] && prayerData[month][day];
            if (!dayTimes) return;
            
            const date = new Date(currentDisplayYear, month - 1, day);
            const dateStr = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('modalTitle').textContent = dateStr;
            
            const prayerList = document.getElementById('modalPrayerList');
            prayerList.innerHTML = '';
            
            const prayerKeys = ['fajr', 'zuhr', 'asr', 'maghrib', 'isha'];
            
            prayerKeys.forEach((prayer, index) => {
                const prayerItem = document.createElement('div');
                prayerItem.className = 'modal-prayer-item';
                
                // Special handling for Fajr to include sunrise time
                if (prayer === 'fajr') {
                    const sunriseTime = sunriseData[month] && sunriseData[month][day] ? sunriseData[month][day] : "06:00";
                    prayerItem.innerHTML = `
                        <div class="modal-prayer-info">
                            <span class="modal-prayer-icon">${prayerIcons[index]}</span>
                            <div>
                                <span class="modal-prayer-name">${prayerNames[index]}</span>
                                <div style="font-size: 11px; opacity: 0.6; margin-top: 2px; color: #B8B8B8;">Sunrise: ${sunriseTime}</div>
                            </div>
                        </div>
                        <div class="modal-prayer-time">
                            <div class="modal-jamah-time">${dayTimes[prayer].jamah}</div>
                            <div class="modal-begin-time">${dayTimes[prayer].begin}</div>
                        </div>
                    `;
                } else {
                    prayerItem.innerHTML = `
                        <div class="modal-prayer-info">
                            <span class="modal-prayer-icon">${prayerIcons[index]}</span>
                            <span class="modal-prayer-name">${prayerNames[index]}</span>
                        </div>
                        <div class="modal-prayer-time">
                            <div class="modal-jamah-time">${dayTimes[prayer].jamah}</div>
                            <div class="modal-begin-time">${dayTimes[prayer].begin}</div>
                        </div>
                    `;
                }
                prayerList.appendChild(prayerItem);
            });
            
            // Check if the selected day is Friday and update Zuhr to Jumu'ah
            const selectedDate = new Date(currentDisplayYear, month - 1, day);
            const dayOfWeek = selectedDate.getDay();
            if (dayOfWeek === 5) {
                const zuhrItem = prayerList.children[1]; // Zuhr is the second item (index 1)
                const zuhrNameElement = zuhrItem.querySelector('.modal-prayer-name');
                zuhrNameElement.textContent = "Jumu'ah";
            }
            
            document.getElementById('dayModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('dayModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('dayModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        function generateWeeklyView() {
            const now = new Date();
            const weekGrid = document.getElementById('weekGrid');
            const weekTitle = document.querySelector('#weeklyChart h3');
            
            if (!weekGrid || !weekTitle) {
                return;
            }
            
            // Calculate start and end dates for the week
            const startDate = new Date(now);
            const endDate = new Date(now);
            endDate.setDate(endDate.getDate() + 6);
            
            // Update week title
            const startStr = startDate.getDate();
            const endStr = endDate.getDate();
            const monthStr = startDate.toLocaleDateString('en-US', { month: 'long' });
            weekTitle.textContent = `${startStr} - ${endStr} ${monthStr}`;
            
            // Clear existing grid
            weekGrid.innerHTML = '';
            
            // Generate 7 days starting from today
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(now);
                currentDate.setDate(currentDate.getDate() + i);
                
                const day = currentDate.getDate();
                const month = currentDate.getMonth() + 1;
                const dayName = currentDate.toLocaleDateString('en-US', { weekday: 'short' });
                
                // Get prayer times for this day
                const dayTimes = prayerData[month] && prayerData[month][day];
                
                const dayItem = document.createElement('div');
                dayItem.className = `day-item ${i === 0 ? 'today' : ''}`;
                dayItem.setAttribute('onclick', `openDayModal(${day}, ${month})`);
                
                if (dayTimes) {
                    // Check if this day is Friday
                    const weekDayOfWeek = currentDate.getDay();
                    const zuhrLabel = weekDayOfWeek === 5 ? "J" : "Z"; // J for Jumu'ah, Z for Zuhr
                    
                    // Get sunrise time for this day
                    const sunriseTime = sunriseData[month] && sunriseData[month][day] ? sunriseData[month][day] : "06:00";
                    
                    dayItem.innerHTML = `
                        <div class="day-name">${dayName}</div>
                        <div style="font-weight: 600; margin-bottom: 3px;">${day}</div>
                        <div class="prayer-times-mini">
                            <div class="prayer-time-mini">F: ${dayTimes.fajr.jamah}</div>
                            <div class="prayer-time-mini" style="font-size: 7px; opacity: 0.7;">SR: ${sunriseTime}</div>
                            <div class="prayer-time-mini">${zuhrLabel}: ${dayTimes.zuhr.jamah}</div>
                            <div class="prayer-time-mini">A: ${dayTimes.asr.jamah}</div>
                            <div class="prayer-time-mini">M: ${dayTimes.maghrib.jamah}</div>
                            <div class="prayer-time-mini">I: ${dayTimes.isha.jamah}</div>
                        </div>
                    `;
                } else {
                    dayItem.innerHTML = `
                        <div class="day-name">${dayName}</div>
                        <div style="font-weight: 600; margin-bottom: 3px;">${day}</div>
                        <div class="prayer-times-mini">
                            <div class="prayer-time-mini">No data</div>
                        </div>
                    `;
                }
                
                weekGrid.appendChild(dayItem);
            }
        }

        // Convert prayer time to minutes, accounting for AM/PM
        function prayerTimeToMinutes(timeStr, prayerName) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            
            // Fajr is always AM (early morning)
            if (prayerName === 'fajr') {
                return hours * 60 + minutes;
            }
            
            // All other prayers are PM
            // For 12-hour format times that show as single digit or are clearly PM
            if (hours >= 1 && hours <= 11) {
                return (hours + 12) * 60 + minutes; // Convert to 24-hour format
            }
            
            // If it's already in 24-hour format or is 12 PM
            return hours * 60 + minutes;
        }

        // Update countdown every second
        function updateCountdown() {
            const now = new Date();
            const today = now.getDate();
            const month = now.getMonth() + 1;
            
            // Get today's prayer times from the data
            const todayTimes = prayerData[month] && prayerData[month][today] ? prayerData[month][today] : {
                fajr: { jamah: "4:15", begin: "2:57" },
                zuhr: { jamah: "1:30", begin: "1:10" },
                asr: { jamah: "7:30", begin: "6:40" },
                maghrib: { jamah: "9:26", begin: "9:21" },
                isha: { jamah: "10:50", begin: "10:37" }
            };

            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTimeInMinutes = currentHour * 60 + currentMinute;

            // Convert begin times to minutes for comparison with proper AM/PM handling
            const beginTimes = [
                { name: 'Fajr', time: prayerTimeToMinutes(todayTimes.fajr.begin, 'fajr'), timeStr: todayTimes.fajr.begin },
                { name: 'Zuhr', time: prayerTimeToMinutes(todayTimes.zuhr.begin, 'zuhr'), timeStr: todayTimes.zuhr.begin },
                { name: 'Asr', time: prayerTimeToMinutes(todayTimes.asr.begin, 'asr'), timeStr: todayTimes.asr.begin },
                { name: 'Maghrib', time: prayerTimeToMinutes(todayTimes.maghrib.begin, 'maghrib'), timeStr: todayTimes.maghrib.begin },
                { name: 'Isha', time: prayerTimeToMinutes(todayTimes.isha.begin, 'isha'), timeStr: todayTimes.isha.begin }
            ];

            let nextPrayerTime = null;
            let nextPrayerName = null;

            // Find next begin time today
            for (let begin of beginTimes) {
                if (currentTimeInMinutes < begin.time) {
                    nextPrayerTime = parseTime(begin.timeStr, begin.name.toLowerCase());
                    nextPrayerName = begin.name;
                    break;
                }
            }

            // If no next prayer today, use tomorrow's Fajr
            if (!nextPrayerTime) {
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowDay = tomorrow.getDate();
                const tomorrowMonth = tomorrow.getMonth() + 1;
                const tomorrowTimes = prayerData[tomorrowMonth] && prayerData[tomorrowMonth][tomorrowDay];
                const tomorrowFajrBegin = tomorrowTimes ? tomorrowTimes.fajr.begin : "2:57";
                
                nextPrayerTime = parseTime(tomorrowFajrBegin, 'fajr');
                nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
                nextPrayerName = 'Fajr';
            }

            // Update prayer name in next prayer section
            document.getElementById('nextPrayerName').textContent = nextPrayerName;

            const timeDiff = nextPrayerTime - now;
            
            if (timeDiff > 0) {
                const hours = Math.floor(timeDiff / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Update prayer highlighting
            updatePrayerHighlighting();
        }

        function updatePrayerHighlighting() {
            const now = new Date();
            const today = now.getDate();
            const month = now.getMonth() + 1;
            
            // Get today's prayer times from the data
            const todayTimes = prayerData[month] && prayerData[month][today] ? prayerData[month][today] : {
                fajr: { jamah: "4:15", begin: "2:57" },
                zuhr: { jamah: "1:30", begin: "1:10" },
                asr: { jamah: "7:30", begin: "6:40" },
                maghrib: { jamah: "9:26", begin: "9:21" },
                isha: { jamah: "10:50", begin: "10:37" }
            };

            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTimeInMinutes = currentHour * 60 + currentMinute;

            // Convert prayer begin times to minutes with proper AM/PM handling
            const fajrBeginMinutes = prayerTimeToMinutes(todayTimes.fajr.begin, 'fajr');
            const zuhrBeginMinutes = prayerTimeToMinutes(todayTimes.zuhr.begin, 'zuhr');
            const asrBeginMinutes = prayerTimeToMinutes(todayTimes.asr.begin, 'asr');
            const maghribBeginMinutes = prayerTimeToMinutes(todayTimes.maghrib.begin, 'maghrib');
            const ishaBeginMinutes = prayerTimeToMinutes(todayTimes.isha.begin, 'isha');
            
            // Get sunrise time and convert to minutes
            const sunriseTime = sunriseData[month] && sunriseData[month][today] ? sunriseData[month][today] : "6:00";
            const sunriseMinutes = prayerTimeToMinutes(sunriseTime, 'fajr'); // Use 'fajr' logic for AM time

            // Determine current prayer based on time
            let currentPrayer = null;

            if (currentTimeInMinutes >= fajrBeginMinutes && currentTimeInMinutes < sunriseMinutes) {
                // Fajr is current only until sunrise (not until Zuhr)
                currentPrayer = 'Fajr';
            } else if (currentTimeInMinutes >= zuhrBeginMinutes && currentTimeInMinutes < asrBeginMinutes) {
                currentPrayer = 'Zuhr';
            } else if (currentTimeInMinutes >= asrBeginMinutes && currentTimeInMinutes < maghribBeginMinutes) {
                currentPrayer = 'Asr';
            } else if (currentTimeInMinutes >= maghribBeginMinutes && currentTimeInMinutes < ishaBeginMinutes) {
                currentPrayer = 'Maghrib';
            } else if (currentTimeInMinutes >= ishaBeginMinutes || currentTimeInMinutes < fajrBeginMinutes) {
                // Isha continues until next day's Fajr
                currentPrayer = 'Isha';
            }
            // Note: Between sunrise and Zuhr begin, there is no current prayer

            // Remove existing classes
            document.querySelectorAll('.prayer-row').forEach(row => {
                row.classList.remove('current');
                const statusElement = row.querySelector('.prayer-details p');
                statusElement.textContent = '';
            });

            // Add current prayer highlighting (green) only
            if (currentPrayer) {
                const currentRow = document.querySelector(`[data-prayer="${currentPrayer.toLowerCase()}"]`);
                if (currentRow) {
                    currentRow.classList.add('current');
                    const statusElement = currentRow.querySelector('.prayer-details p');
                    if (currentPrayer === 'Fajr') {
                        statusElement.textContent = `Current Prayer | Sunrise: ${sunriseTime}`;
                    } else {
                        statusElement.textContent = 'Current Prayer';
                    }
                }
            }

            // Update today's prayer times in the display
            updateTodaysPrayerTimes();
        }

        function updateTodaysPrayerTimes() {
            const now = new Date();
            const today = now.getDate();
            const month = now.getMonth() + 1;
            
            const todayTimes = prayerData[month] && prayerData[month][today];
            if (todayTimes) {
                const prayerRows = document.querySelectorAll('.prayer-row');
                const prayers = ['fajr', 'zuhr', 'asr', 'maghrib', 'isha'];
                
                prayers.forEach((prayer, index) => {
                    const row = prayerRows[index];
                    const jamahTime = row.querySelector('.jamah-time');
                    const beginTime = row.querySelector('.begin-time');
                    
                    jamahTime.textContent = todayTimes[prayer].jamah;
                    beginTime.textContent = todayTimes[prayer].begin;
                });
                
                // Add sunrise time to Fajr prayer row
                const fajrRow = document.querySelector('[data-prayer="fajr"]');
                if (fajrRow) {
                    const statusElement = fajrRow.querySelector('.prayer-details p');
                    const sunriseTime = sunriseData[month] && sunriseData[month][today] ? sunriseData[month][today] : "06:00";
                    
                    // Check if Fajr is current prayer
                    if (fajrRow.classList.contains('current')) {
                        statusElement.textContent = `Current Prayer | Sunrise: ${sunriseTime}`;
                    } else {
                        statusElement.textContent = `Sunrise: ${sunriseTime}`;
                    }
                }
                
                // Check if today is Friday and update Zuhr to Jumu'ah
                const dayOfWeek = now.getDay(); // 0 = Sunday, 5 = Friday
                if (dayOfWeek === 5) {
                    const zuhrRow = document.querySelector('[data-prayer="zuhr"]');
                    if (zuhrRow) {
                        const prayerNameElement = zuhrRow.querySelector('.prayer-details h4');
                        prayerNameElement.textContent = "Jumu'ah";
                    }
                }
            }
        }

        function parseTime(timeStr, prayerName) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const date = new Date();
            
            // Fajr is always AM (early morning)
            if (prayerName === 'fajr') {
                date.setHours(hours, minutes, 0, 0);
            } else {
                // All other prayers are PM
                // Convert to 24-hour format if needed
                if (hours >= 1 && hours <= 11) {
                    date.setHours(hours + 12, minutes, 0, 0);
                } else {
                    date.setHours(hours, minutes, 0, 0);
                }
            }
            
            return date;
        }

        // Initialize the app
        function init() {
            // Update current date
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric',
                year: 'numeric'
            });
            document.getElementById('currentDate').textContent = dateStr;
            
            // Set current display month to current month
            currentDisplayMonth = now.getMonth() + 1;
            currentDisplayYear = now.getFullYear();
            
            // Initialize PWA status
            updatePWAStatus();
            
            // Generate dynamic monthly and weekly views
            generateMonthlyView();
            generateWeeklyView();
            updateNavigationButtons();
            
            // Start countdown and update functions
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            // Handle URL shortcuts
            handleUrlShortcuts();
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });
        
        // Also call init if DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
